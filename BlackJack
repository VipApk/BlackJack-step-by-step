#include <iostream>
#include <vector>
#include <ctime>
#include <cstdlib>

using namespace std;

enum Suit { HEARTS, DIAMONDS, CLUBS, SPADES };

class Card {
public:
    int value; 
    Suit suit;

    Card(int v, Suit s) : value(v), suit(s) {}

    void printCard() const {
        string cardValue;
        if (value == 1)
            cardValue = "Ace";
        else if (value == 11)
            cardValue = "Jack";
        else if (value == 12)
            cardValue = "Queen";
        else if (value == 13)
            cardValue = "King";
        else
            cardValue = to_string(value);

        string suitName;
        switch (suit) {
            case HEARTS: suitName = "Hearts"; break;
            case DIAMONDS: suitName = "Diamonds"; break;
            case CLUBS: suitName = "Clubs"; break;
            case SPADES: suitName = "Spades"; break;
        }

        cout << cardValue << " of " << suitName << endl;
    }

    int getBlackjackValue() const {
        if (value > 10) {
            return 10;
        }
        return value; 
    }
};

class Deck {
private:
    vector<Card> deck;
    int currentCardIndex;

public:
    Deck() {
        // Initialize a standard 52-card deck
        for (int suit = HEARTS; suit <= SPADES; ++suit) {
            for (int value = 1; value <= 13; ++value) {
                deck.push_back(Card(value, static_cast<Suit>(suit)));
            }
        }
        currentCardIndex = 0;
        srand(time(0));  // Seed random number generator
    }

    void shuffleDeck() {
        for (int i = 0; i < deck.size(); ++i) {
            int randIndex = rand() % deck.size();
            swap(deck[i], deck[randIndex]);
        }
    }

    Card dealCard() {
        if (currentCardIndex >= deck.size()) {
            shuffleDeck();
            currentCardIndex = 0;
        }
        return deck[currentCardIndex++];
    }
};

class Player {
private:
    vector<Card> hand;
    bool isDealer;

public:
    Player(bool dealer = false) : isDealer(dealer) {}

    void takeCard(Card card) {
        hand.push_back(card);
    }

    int getHandValue() const {
        int totalValue = 0;
        int aces = 0;

        for (const Card &card : hand) {
            int value = card.getBlackjackValue();
            totalValue += value;
            if (value == 1) {
                aces++;
            }
        }

        while (aces > 0 && totalValue + 10 <= 21) {
            totalValue += 10;
            aces--;
        }

        return totalValue;
    }

    void showHand(bool revealAll = true) const {
        cout << (isDealer ? "Dealer's hand: " : "Player's hand: ") << endl;
        for (int i = 0; i < hand.size(); ++i) {
            if (!revealAll && i == 0 && isDealer) {
                cout << "Hidden card" << endl;
            } else {
                hand[i].printCard();
            }
        }
        if (revealAll) {
            cout << "Total value: " << getHandValue() << endl;
        }
    }

    bool isBusted() const {
        return getHandValue() > 21;
    }
};

void playBlackjack() {
    Deck deck;
    deck.shuffleDeck();

    Player player;
    Player dealer(true);
    player.takeCard(deck.dealCard());
    player.takeCard(deck.dealCard());
    dealer.takeCard(deck.dealCard());
    dealer.takeCard(deck.dealCard());

    player.showHand();
    dealer.showHand(false);  // Hide dealer's first card

    char choice;
    while (true) {
        cout << "Do you want to hit (h) or stand (s)? ";
        cin >> choice;
        if (choice == 'h') {
            player.takeCard(deck.dealCard());
            player.showHand();
            if (player.isBusted()) {
                cout << "You busted! Dealer wins." << endl;
                return;
            }
        } else if (choice == 's') {
            break;
        }
    }

    dealer.showHand();
    while (dealer.getHandValue() < 17) {
        cout << "Dealer hits." << endl;
        dealer.takeCard(deck.dealCard());
        dealer.showHand();
        if (dealer.isBusted()) {
            cout << "Dealer busted! You win." << endl;
            return;
        }
    }

    int playerValue = player.getHandValue();
    int dealerValue = dealer.getHandValue();

    if (playerValue > dealerValue) {
        cout << "You win!" << endl;
    } else if (dealerValue > playerValue) {
        cout << "Dealer wins!" << endl;
    } else {
        cout << "It's a tie!" << endl;
    }
}

int main() {
    cout << "Welcome to Blackjack!" << endl;
    playBlackjack();
    return 0;
}
